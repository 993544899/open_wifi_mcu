# smart_color_lamp_demo：模拟智能彩灯
------------------------------------------

## 开发演示视频

![模拟智能彩灯-演示视频](https://smart-img.5itianyuan.com/open/smart_color_lamp_demo.mp4)

## 功能说明

> 基于甜园智能云平台开发板，模拟智能彩灯变换以及控制操作

## 硬件操作说明

> 三路按键KEY1、KEY2、KEY3分别控制RGB彩灯的绿色、红色、蓝色彩灯的亮灭

> KEY1按键短按G灯切换状态，长按则切换状态过程为渐变型，KEY2按键短按R灯切换状态，长按则进入入网模式，KEY3按键短按B灯切换状态，长按则切换状态过程为渐变型

> KEY2长按入网（3S），当长按**KEY2**按键，**LED4**进入闪烁状态开发板开始入网，通过**甜园app[添加设备步骤](app_add_wifidevelopboard.md)**,入网添加开发板设备，当wifi模块入网成功LED4指示灯常亮，并且wifi状态指示灯常亮

> 通过甜园APP添加开发板成功后，操作按键KEY1，KEY2，KEY3，app设备界面的一路目标值、二路目标值、三路目标值会有按键状态的改变（0-255）。

## Demo程序结构介绍

#### 系统时钟、定时器以及外围接口的初始化等

> RCC时钟配置，NVIC配置，初始化Time2定时器用于计时，初始化按键，初始化LED灯，RGB彩灯等外围设备

#### 串口透传数据解析

> 初始化uart3，波特率为115200，根据甜园智能云平台的wifi串口协议，进行数据的传输以及解析。

#### 按键控制功能

> 初始化按键KEY1、KEY2、KEY3，并初始化RGB彩灯、LED4，其中LED4用于wifi入网状态显示操作，PB15开漏输出用于RSTwifi模块

> 采用轮询方式对按键监控处理，通过按键的动作，对RGB彩灯进行控制，并将该动作通过协议帧格式发送给wifi并上报到甜园云服务器，实现智能化控制。

## 注意

> esp8266固件请勿私自烧录改动，如损坏固件则无法恢复

> esp8266的wifi状态指示灯开机正常运行状态为闪烁，入网成功后会停止闪烁并常亮

> stm32的demo示例中必须将PB15设置成开漏输出，否则esp8266模块会无法正常启动

> MCU与esp8266对接，联网过程中esp8266模块会通过串口向MCU请求消息，包括**chipid**、**vcode**、**pcode**、**hardwareversion**、**softwareversion**等必要的注册信息
